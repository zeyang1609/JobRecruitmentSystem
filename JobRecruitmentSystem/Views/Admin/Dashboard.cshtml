@model IEnumerable<JobRecruitmentSystem.Models.User>
@{
    ViewData["Title"] = "Admin Dashboard";
}

<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-secondary">User Management</h2>

        <div class="d-flex gap-2">
            <select id="roleFilter" class="form-select w-auto">
                <option value="All">All Roles</option>
                <option value="Admin">Admin</option>
                <option value="Employer">Employer</option>
                <option value="JobSeeker">JobSeeker</option>
            </select>

            <input type="text" id="searchInput" class="form-control" placeholder="Type to search..." style="width: 250px;">
        </div>
    </div>

    <div id="tableContainer">
        <partial name="_UserTable" model="Model" />
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Function to fetch data
            function loadData(sortOrder = "") {
                var searchValue = $("#searchInput").val();
                var roleValue = $("#roleFilter").val();

                $.ajax({
                    url: '@Url.Action("Dashboard", "Admin")',
                    type: 'GET',
                    data: {
                        searchString: searchValue,
                        filterRole: roleValue,
                        sortOrder: sortOrder
                    },
                    success: function (result) {
                        $("#tableContainer").html(result);
                    }
                });
            }

            // 1. Real-Time Search with "Debounce" (Wait 500ms after typing stops)
            let timeout = null;
            $("#searchInput").on('input', function () {
                clearTimeout(timeout);
                timeout = setTimeout(function () {
                    loadData();
                }, 500);
            });

            // 2. Filter Dropdown Change
            $("#roleFilter").change(function () {
                loadData();
            });

            // 3. Sorting Clicks (Delegate event because table refreshes)
            $(document).on("click", ".sort-link", function (e) {
                e.preventDefault();
                var sortValue = $(this).data("sort");
                loadData(sortValue);
            });
        });
    </script>
}